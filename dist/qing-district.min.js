/* qing-district v0.0.1 | (c) Mycolorway Design | MIT License */
!function(t,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("qing-module")):t.QingDistrict=e(t.jQuery,t.QingModule)}(this,function(t,e){var i=require=function t(e,i,r){function o(s,c){if(!i[s]){if(!e[s]){var p="function"==typeof require&&require;if(!c&&p)return p(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return o(i?i:t)},l,l.exports,t,e,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(i,r,o){var n,s=function(t,e){function i(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return s(i,e),i.prototype.load=function(t){return t.call(null,function(t){return function(e){return t.data=t.formatData(e),t.trigger("loaded",[t.data])}}(this))},i.prototype.formatData=function(e){var i,r,o,n,s,c,p,u,l,a,h,d,f,y;if(t.isArray(e)){for(d={},r={},o={},s=0,u=e.length;s<u;s++)for(h=e[s],d[h.code]={code:h.code,name:h.name,cities:[]},f=h.cities,c=0,l=f.length;c<l;c++)for(i=f[c],d[h.code].cities.push(i.code),r[i.code]={code:i.code,name:i.name,counties:[]},y=i.counties,p=0,a=y.length;p<a;p++)n=y[p],r[i.code].counties.push(n.code),o[n.code]={code:n.code,name:n.name};return{province:d,city:r,county:o}}},i}(e),r.exports=n},{}],2:[function(i,r,o){var n,s=function(t,e){function i(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=function(e){function i(){i.__super__.constructor.apply(this,arguments),this.el=t('<div class="district-field-proxy-group">\n  <span class="placeholder">'+this.opts.placeholder+"</span>\n</div>").appendTo(this.opts.wrapper),this._bind(),this.setEmpty(!0)}return s(i,e),i.prototype.opts={wrapper:null,placeholder:"Please select"},i.prototype._bind=function(){return this.el.on("click",".placeholder",function(t){return function(){return t.trigger("emptySelect")}}(this))},i.prototype.setEmpty=function(t){return this.el.toggleClass("empty",t)},i}(e),r.exports=n},{}],3:[function(i,r,o){var n,s=function(t,e){function i(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=function(e){function i(){var e;i.__super__.constructor.apply(this,arguments),e=this.opts,this.group=e.group,this.data=e.data,this.field=e.field,this.el=t('<a class="district-field-proxy" href="javascript:;"></a>').hide().appendTo(this.group.el),this.el.on("click",function(t){return function(e){return t.setActive(!0)}}(this))}return s(i,e),i.prototype.opts={group:null,data:null,field:null},i.prototype.restore=function(){var t,e;if(t=this.field.val())return this.setItem(e=this.data[t]),this.trigger("restore",[e])},i.prototype.isFilled=function(){return!!this.field.val()},i.prototype.setActive=function(t){return this.el.text(this.el.text()||"_").toggle(t),this.highlight(t),t&&this.trigger("active",this.getItem()),this},i.prototype.highlight=function(t){return this.el.toggleClass("active",t)},i.prototype.getItem=function(){return this.el.data("item")},i.prototype.setItem=function(t){return this.el.text(t.name).data("item",t).show(),this.field.val(t.code),this},i.prototype.clear=function(){return this.field.val(null),this.el.text("").data("item",null).hide(),this},i}(e),r.exports=n},{}],4:[function(i,r,o){var n,s=function(t,e){function i(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=function(e){function i(){var e;i.__super__.constructor.apply(this,arguments),e=this.opts,this.wrapper=e.wrapper,this.data=e.data,this.codes=e.codes,this.el=t('<div class="district-list">\n  <dl><dd></dd></dl>\n</div>').hide().appendTo(this.wrapper),this.render(),this._bind()}return s(i,e),i.prototype.opts={wrapper:null,data:null,codes:[]},i.prototype.highlightItem=function(t){if(this.el.find("a").removeClass("active"),t)return this.el.find("[data-code="+t.code+"]").addClass("active")},i.prototype.show=function(){return this.el.show(),this.trigger("show")},i.prototype.hide=function(){return this.el.hide(),this.trigger("hide")},i.prototype._bind=function(){return this.el.on("click","a",function(e){return function(i){var r;return r=t(i.currentTarget),e.setCurrent(e.data[r.data("code")]),e.hide(),e.trigger("afterSelect",[e.current]),!1}}(this))},i.prototype.setCurrent=function(t){return this.highlightItem(this.current=t),this},i.prototype.setCodes=function(t){return this.codes=t,this},i.prototype.render=function(){var e,i,r,o,n,s;if("all"===this.codes&&(this.codes=Object.keys(this.data)),this.codes){for(this.el.find("dd").empty(),n=this.codes,i=0,o=n.length;i<o;i++)e=n[i],r=this.data[e],t("<a title='"+r.name+"' data-code='"+r.code+"' href='javascript:;'>\n  "+r.name+"\n</a>").appendTo(this.el.find("dd"));return this.highlightItem(this.data[null!=(s=this.current)?s.code:void 0]),this.show(),this}},i}(e),r.exports=n},{}],5:[function(i,r,o){var n,s=function(t,e){function i(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=function(e){function i(){i.__super__.constructor.apply(this,arguments),this.wrapper=t(this.opts.wrapper),this.target=t(this.opts.target),this.el=t('<div class="district-popover"></div>').hide().appendTo(this.wrapper)}return s(i,e),i.prototype.opts={target:null,wrapper:null},i.prototype.setActive=function(t){return t?this._show():this._hide()},i.prototype._show=function(){if(!this.el.is(":visible"))return this.el.show(),t(document).off("click.qing-district").on("click.qing-district",function(e){return function(i){var r;if(r=t(i.target),e.wrapper.hasClass("active")&&!e.target.has(r).length&&!r.is(e.target))return e._hide()}}(this)),this.trigger("show")},i.prototype._hide=function(){if(this.el.is(":visible"))return t(document).off(".qing-district"),this.el.hide(),this.trigger("hide")},i.prototype.destroy=function(){return t(document).off(".qing-district"),this.el.remove()},i}(e),r.exports=n},{}],"qing-district":[function(i,r,o){var n,s,c,p,u,l,a=function(t,e){function i(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;n=i("./data-store.coffee"),u=i("./popover.coffee"),s=i("./field-proxy.coffee"),c=i("./field-proxy-group.coffee"),p=i("./list.coffee"),l=function(e){function i(e){var r;if(i.__super__.constructor.apply(this,arguments),this.el=t(this.opts.el),!(this.el.length>0))throw new Error("QingDistrict: option el is required");if(r=this.el.data("qingDistrict"))return r;if(!t.isFunction(this.opts.dataSource))throw new Error("QingDistrict: option dataSource is required");t.extend(this.opts,i.opts,e),this.locales=this.opts.locales||i.locales,this.dataStore=new n,this.dataStore.on("loaded",function(t){return function(e,i){return t._render(),t._init(i),t._bind(),t._restore(),t.trigger("ready")}}(this)),this.dataStore.load(this.opts.dataSource)}return a(i,e),i.opts={el:null,dataSource:null,locales:{placeholder:"Please select"}},i.prototype._render=function(){return this.wrapper=t('<div class="qing-district-wrapper"></div>').data("district",this).prependTo(this.el),this.el.addClass(" qing-district").data("qingDistrict",this)},i.prototype._init=function(t){return this.popover=new u({target:this.el,wrapper:this.wrapper}),this.provinceList=new p({wrapper:this.popover.el,data:t.province,codes:"all"}),this.cityList=new p({wrapper:this.popover.el,data:t.city}),this.countyList=new p({wrapper:this.popover.el,data:t.county}),this.fieldGroup=new c({wrapper:this.wrapper,placeholder:this.locales.placeholder}),this.provinceField=new s({group:this.fieldGroup,data:t.province,field:this.el.find("[data-province-field]")}),this.cityField=new s({group:this.fieldGroup,data:t.city,field:this.el.find("[data-city-field]")}),this.countyField=new s({group:this.fieldGroup,data:t.county,field:this.el.find("[data-county-field]")})},i.prototype._bind=function(){return this.fieldGroup.on("emptySelect",function(t){return function(){return t.cityList.hide(),t.countyList.hide(),t.provinceList.render(),t.popover.setActive(!0)}}(this)),this.popover.on("show",function(t){return function(){return t.wrapper.addClass("active")}}(this)).on("hide",function(t){return function(){if(t.wrapper.removeClass("active"),t._hideAllExcpet("none"),!t.isFullFilled())return t.provinceList.setCurrent(null),t.provinceField.clear(),t.cityField.clear(),t.countyField.clear(),t.fieldGroup.setEmpty(!0)}}(this)),this.provinceField.on("active",function(t){return function(e,i){return t._hideAllExcpet("province"),i&&t.provinceList.setCurrent(i).show(),t.popover.setActive(!0)}}(this)),this.provinceList.on("afterSelect",function(t){return function(e,i){var r;return t.fieldGroup.setEmpty(!1),t.provinceField.setItem(i),r=t.cityList.data[i.cities[0]],t._isMunicipality(i,r)?(t.cityList.setCurrent(r).hide(),t.cityList.trigger("afterSelect",t.cityList.current),t.cityField.setActive(!1)):(t.cityList.setCodes(i.cities).render(),t.cityField.clear().setActive(!0),t.countyField.clear())}}(this)),this.cityField.on("active",function(t){return function(e,i){return t._hideAllExcpet("city"),i&&t.cityList.setCurrent(i).show(),t.popover.setActive(!0)}}(this)).on("restore",function(t){return function(){return t.cityList.setCodes(t.provinceField.getItem().cities).render()}}(this)),this.cityList.on("afterSelect",function(t){return function(e,i){return t.fieldGroup.setEmpty(!1),t.cityField.setItem(i),t.countyList.setCodes(i.counties).render(),t.countyField.clear().setActive(!0,!0)}}(this)),this.countyField.on("active",function(t){return function(e,i){return t._hideAllExcpet("county"),i&&t.countyList.setCurrent(i).show(),t.popover.setActive(!0)}}(this)).on("restore",function(t){return function(){return t.countyList.setCodes(t.cityField.getItem().counties).render()}}(this)),this.countyList.on("afterSelect",function(t){return function(e,i){return t.fieldGroup.setEmpty(!1),t.countyField.setItem(i).highlight(!1),t.popover.setActive(!1)}}(this))},i.prototype._restore=function(){if(this.provinceField.restore(),this.cityField.restore(),this._isMunicipality(this.provinceField.getItem(),this.cityField.getItem())&&this.cityField.setActive(!1),this.countyField.restore(),this.isFullFilled())return this.fieldGroup.setEmpty(!1)},i.prototype._isMunicipality=function(t,e){return!(!t||!e)&&(1===t.cities.length&&e.name===t.name)},i.prototype._hideAllExcpet=function(t){var e,i,r,o,n;for(o=["province","city","county"],n=[],i=0,r=o.length;i<r;i++)e=o[i],e!==t?(this[e+"List"].hide(),n.push(this[e+"Field"].highlight(!1))):n.push(void 0);return n},i.prototype.isFullFilled=function(){return this.provinceField.isFilled()&&this.cityField.isFilled()&&this.countyField.isFilled()},i.prototype.destroy=function(){return this.popover.destroy(),this.wrapper.remove(),this.el.removeClass("qing-district").removeData("qingDistrict")},i}(e),r.exports=l},{"./data-store.coffee":1,"./field-proxy-group.coffee":2,"./field-proxy.coffee":3,"./list.coffee":4,"./popover.coffee":5}]},{},[]);return i("qing-district")});